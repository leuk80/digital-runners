---
import { useTranslations } from '../i18n/utils';
import type { Lang } from '../i18n/utils';

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
---

<form
  id="contact-form"
  class="space-y-6"
  method="POST"
  action="/api/contact"
  novalidate
>
  <div>
    <label for="name" class="block text-sm font-medium text-slate-700 mb-1">
      {t('contact.name')} <span class="text-red-500">*</span>
    </label>
    <input
      type="text"
      id="name"
      name="name"
      required
      class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition"
      placeholder="Max Muster"
    />
  </div>

  <div>
    <label for="email" class="block text-sm font-medium text-slate-700 mb-1">
      {t('contact.email')} <span class="text-red-500">*</span>
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
      class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition"
      placeholder="max@beispiel.ch"
    />
  </div>

  <div>
    <label for="message" class="block text-sm font-medium text-slate-700 mb-1">
      {t('contact.message')} <span class="text-red-500">*</span>
    </label>
    <textarea
      id="message"
      name="message"
      required
      rows="5"
      class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition resize-none"
      placeholder={lang === 'de' ? 'Wie kÃ¶nnen wir Ihnen helfen?' : 'How can we help you?'}
    ></textarea>
  </div>

  <div id="form-success" class="hidden bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg text-sm">
    {t('contact.success')}
  </div>
  <div id="form-error" class="hidden bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg text-sm">
    {t('contact.error')}
  </div>

  <button
    type="submit"
    id="form-submit"
    class="w-full bg-cyan-500 hover:bg-cyan-400 disabled:opacity-60 disabled:cursor-not-allowed text-slate-900 font-semibold px-6 py-3 rounded-lg transition-colors flex items-center justify-center gap-2"
  >
    <span id="submit-text">{t('contact.send')}</span>
    <i id="submit-spinner" class="ci ci-Loading hidden text-lg animate-spin"></i>
  </button>
</form>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement | null;
  const successEl = document.getElementById('form-success');
  const errorEl = document.getElementById('form-error');
  const submitBtn = document.getElementById('form-submit') as HTMLButtonElement | null;
  const submitText = document.getElementById('submit-text');
  const spinner = document.getElementById('submit-spinner');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!form) return;

    successEl?.classList.add('hidden');
    errorEl?.classList.add('hidden');
    if (submitBtn) submitBtn.disabled = true;
    submitText?.classList.add('hidden');
    spinner?.classList.remove('hidden');

    try {
      const res = await fetch('/api/contact', {
        method: 'POST',
        body: new FormData(form),
      });
      if (res.ok) {
        successEl?.classList.remove('hidden');
        form.reset();
      } else {
        errorEl?.classList.remove('hidden');
      }
    } catch {
      errorEl?.classList.remove('hidden');
    } finally {
      if (submitBtn) submitBtn.disabled = false;
      submitText?.classList.remove('hidden');
      spinner?.classList.add('hidden');
    }
  });
</script>
