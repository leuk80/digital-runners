---
import { useTranslations, getAlternatePath } from '../i18n/utils';
import type { Lang } from '../i18n/utils';
import { languages } from '../i18n/ui';
import Icon from './Icon.astro';

interface Props {
  lang: Lang;
  alternatePath?: string;
}

const { lang, alternatePath } = Astro.props;
const t = useTranslations(lang);

const navLinks = [
  { key: 'nav.services' as const, href: `/${lang}/leistungen` },
  { key: 'nav.about' as const, href: `/${lang}/ueber-uns` },
  { key: 'nav.portfolio' as const, href: `/${lang}/referenzen` },
  { key: 'nav.blog' as const, href: `/${lang}/blog` },
  { key: 'nav.contact' as const, href: `/${lang}/kontakt` },
];

const currentPath = Astro.url.pathname;
---

<header class="bg-slate-900 text-white sticky top-0 z-50 shadow-lg">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a href={`/${lang}/`} class="flex items-center gap-2 text-xl font-bold hover:text-cyan-400 transition-colors">
        <Icon name="Bulb" class="text-2xl text-cyan-400" />
        Digital Runners
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden md:flex items-center gap-6">
        {navLinks.map(link => (
          <a
            href={link.href}
            class:list={[
              'text-sm font-medium transition-colors hover:text-cyan-400',
              currentPath.startsWith(link.href) ? 'text-cyan-400' : 'text-slate-300',
            ]}
          >
            {t(link.key)}
          </a>
        ))}
        <!-- Language switcher -->
        <div class="flex items-center gap-1 ml-2 border-l border-slate-700 pl-4">
          {Object.entries(languages).map(([code, label]) => (
            <a
              href={code === lang ? '#' : (alternatePath ?? getAlternatePath(currentPath, code as Lang))}
              class:list={[
                'text-xs font-semibold px-2 py-1 rounded transition-colors',
                code === lang
                  ? 'bg-cyan-500 text-slate-900 cursor-default'
                  : 'text-slate-400 hover:text-white hover:bg-slate-700',
              ]}
              aria-current={code === lang ? 'true' : undefined}
            >
              {code.toUpperCase()}
            </a>
          ))}
        </div>
      </nav>

      <!-- Mobile menu button -->
      <button
        id="mobile-menu-btn"
        class="md:hidden text-slate-300 hover:text-white p-2"
        aria-label="Menu öffnen"
        aria-expanded="false"
      >
        <Icon name="Hamburger_MD" class="text-2xl" />
      </button>
    </div>

    <!-- Mobile Nav -->
    <nav id="mobile-menu" class="hidden md:hidden pb-4 border-t border-slate-700 mt-2 pt-4">
      {navLinks.map(link => (
        <a
          href={link.href}
          class:list={[
            'block px-2 py-2 text-sm font-medium rounded transition-colors hover:text-cyan-400 hover:bg-slate-800',
            currentPath.startsWith(link.href) ? 'text-cyan-400' : 'text-slate-300',
          ]}
        >
          {t(link.key)}
        </a>
      ))}
      <div class="flex gap-2 mt-3 px-2">
        {Object.entries(languages).map(([code, label]) => (
          <a
            href={code === lang ? '#' : getAlternatePath(currentPath, code as Lang)}
            class:list={[
              'text-xs font-semibold px-3 py-1 rounded transition-colors',
              code === lang
                ? 'bg-cyan-500 text-slate-900 cursor-default'
                : 'text-slate-400 hover:text-white hover:bg-slate-700',
            ]}
          >
            {code.toUpperCase()} – {label}
          </a>
        ))}
      </div>
    </nav>
  </div>
</header>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  btn?.addEventListener('click', () => {
    const isOpen = !menu?.classList.contains('hidden');
    menu?.classList.toggle('hidden', isOpen);
    btn.setAttribute('aria-expanded', String(!isOpen));
  });
</script>
